<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Beyond Light</title>
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <link rel="stylesheet" type="text/css" href="css/snow.css">
        <link rel="import" href="header.html">
        <link rel="import" href="left-menu.html">
        <link rel="import" href="entity-template.html">
    </head>
    <!-- <body class="scrollbar" id="solid-scrollbar"> -->
    <body style="overflow-y:hidden; height:100%;">
        <div id="snow">
            <header></header>
            <left-menu></left-menu>
            <div id="main-content-template">
                <div class="game-main scrollbar" id="alpha-scrollbar">
                    <entities></entities>
                </div>
            </div>
        </div>
    </body>
    <script src="js/utils.js"></script>
    <script src="js/page-template.js"></script>
    <script src="js/header-ressources.js"></script>
    <script src="js/left-menu.js"></script>
    <script src="js/document-ready.js"></script>
    <script>
        function onUpgradeClick(e) {
            var id = e.target.id.split('-').reverse()[0];
            var request_id = window.cefQuery({
                request: 'index-building-upgrade:' + id,
                persistent: false,
                onSuccess: function(response) {
                    document.getElementById("entity-level-" + id).innerText = "Level " + response;
                    // todo update resources
                },
                onFailure: function(error_code, error_message) {
                    console.log("cannot upgrade building with id: " + id);
                }
            });
        }

        function createBuilding(id, name, level, iron, crystal, iridium, energy) {
            var elements = document.querySelectorAll('link[rel=import]');
            for (var i = 0; i < elements.length; i++) {
                if (elements[i].getAttribute("href") === "entity-template.html") {
                    var post = elements[i].import.querySelector('#entity-template');
                    var template = post.cloneNode(true);
                    template.id = "entity-" + id;
                    Utils.findChildById(template, "entity-name", true).innerText = name;
                    Utils.findChildById(template, "entity-level", true).innerText = "Level " + level;
                    Utils.findChildById(template, "entity-level", true).id += "-" + id;
                    Utils.findChildById(template, "iron-value", true).innerText = iron;
                    Utils.findChildById(template, "crystal-value", true).innerText = crystal;
                    Utils.findChildById(template, "iridium-value", true).innerText = iridium;
                    Utils.findChildById(template, "energy-value", true).innerText = energy;
                    Utils.findChildById(template, "entity-upgrade", true).id += "-" + id;
                    Utils.findChildById(template, "entity-upgrade-" + id, true).onclick = function(e) {onUpgradeClick(e)};
                    var container = document.querySelector('entities');
                    container.appendChild(template);
                    return ;
                }
            }
        }

        ready(function () {
            document.getElementById("buildings").className = "active";
        });
    </script>
</html>

