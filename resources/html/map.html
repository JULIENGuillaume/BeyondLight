<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Beyond Light</title>
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <link rel="import" href="header.html">
        <link rel="import" href="left-menu.html">
        <link rel="import" href="planet-template.html">
    </head>
    <body style="overflow-y:hidden; height:100%;">
        <header></header>
        <left-menu></left-menu>
        <div id="main-content-template">
            <div class="game-main scrollbar" id="alpha-scrollbar">
                    <planets></planets>
            </div>
        </div>
    </body>
    <script src="js/utils.js"></script>
    <script src="js/page-template.js"></script>
    <script src="js/header-resources.js"></script>
    <script src="js/left-menu.js"></script>
    <script src="js/document-ready.js"></script>
    <script>
        function onAttackClick(e) {
            var id = e.target.id.split('-').reverse()[0];
            if (!document.getElementById("entity-attack-" + id).disabled) { // not needed but just in case
                var request_id = window.cefQuery({
                    request: 'index-map-attack:' + id,
                    persistent: false,
                    onSuccess: function (response) {
                        // todo add attack success
                    },
                    onFailure: function (error_code, error_message) {
                        console.log("cannot attack planet at position: " + id);
                        console.log("error code: " + error_code + " reason: " + error_message);
                    }
                });
            }
        }

        function createPlanet(position, username, iron, crystal, iridium, energy, attackable) {
            var elements = document.querySelectorAll('link[rel=import]');
            for (var i = 0; i < elements.length; i++) {
                if (elements[i].getAttribute("href") === "planet-template.html") {
                    var post = elements[i].import.querySelector('#planet-template');
                    var template = post.cloneNode(true);
                    Utils.findChildById(template, "entity-username", true).innerText = username;
                    Utils.findChildById(template, "entity-position", true).innerText = "Position " + position;
                    Utils.findChildById(template, "iron-value", true).innerText = iron;
                    Utils.findChildById(template, "crystal-value", true).innerText = crystal;
                    Utils.findChildById(template, "iridium-value", true).innerText = iridium;
                    Utils.findChildById(template, "energy-value", true).innerText = energy;
                    Utils.findChildById(template, "entity-attack", true).id += "-" + position;
                    Utils.findChildById(template, "entity-attack-" + position, true).onclick = function(e) {onAttackClick(e)};
                    Utils.findChildById(template, "entity-attack-" + position, true).disabled = !attackable;
                    var container = document.querySelector('planets');
                    container.appendChild(template);
                    return ;
                }
            }
        }
        ready(function () {
            document.getElementById("map").className = "active";
        });
    </script>
</html>

